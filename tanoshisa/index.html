<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸŸ¡ æ¥½ã—ã•å¡Šå›åãƒ¡ãƒ¢</title>
  <style>
    :root{
      --bg:#f6f8ff;
      --card:#ffffffcc;
      --ink:#111827;
      --sub:#6b7280;
      --line:#e6eaf6;
      --accent:#4b7cff;
      --accent2:#e9f0ff;
      --danger:#e05555;
      --shadow: 0 10px 30px rgba(20,30,60,.10);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 800px at 20% -10%, #dbe6ff 0%, transparent 60%),
        radial-gradient(900px 600px at 90% 0%, #e9ddff 0%, transparent 55%),
        radial-gradient(900px 700px at 60% 120%, #d9fff2 0%, transparent 55%),
        var(--bg);
      min-height:100vh;
      padding:18px;
    }
    .wrap{max-width:820px;margin:0 auto}
    header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom:14px;
    }
    h1{
      margin:0;
      font-size:28px;
      letter-spacing:.2px;
      display:flex; gap:10px; align-items:center;
    }
    .date{
      color:var(--sub);
      font-size:13px;
      margin-top:6px;
    }
    .pill{
      font-size:12px; padding:6px 10px; border-radius:999px;
      background:rgba(255,255,255,.65); border:1px solid var(--line);
      color:var(--sub);
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      backdrop-filter: blur(10px);
    }
    .card h2{
      margin:0 0 10px 0; font-size:16px;
      display:flex; align-items:center; gap:8px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap}
    input, select, textarea{
      width:100%;
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 12px;
      background:rgba(255,255,255,.85);
      color:var(--ink);
      outline:none;
      font-size:14px;
    }
    textarea{min-height:90px; resize:vertical}
    .w-100{width:100%}
    .w-50{width:calc(50% - 5px)}
    .w-33{width:calc(33.333% - 7px)}
    @media (max-width: 520px){
      .w-50,.w-33{width:100%}
    }
    .btn{
      border:0;
      padding:12px 14px;
      border-radius:14px;
      font-weight:700;
      cursor:pointer;
      background:var(--accent);
      color:#fff;
      transition:.12s;
    }
    .btn:active{transform: translateY(1px)}
    .btn-sub{
      background:var(--accent2);
      color:var(--accent);
      border:1px solid #cfe0ff;
      font-weight:800;
    }
    .btn-danger{
      background:#fff;
      border:1px solid #ffd6d6;
      color:var(--danger);
      font-weight:800;
    }
    .note{color:var(--sub); font-size:12px; margin-top:8px; line-height:1.5}
    .list{
      margin-top:10px;
      display:flex; flex-direction:column; gap:10px;
    }
    .item{
      background:rgba(255,255,255,.86);
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px 12px;
      display:flex; justify-content:space-between; gap:10px;
      align-items:flex-start;
    }
    .item .left{min-width:0}
    .title{
      font-weight:900;
      margin:0 0 4px 0;
      display:flex; gap:8px; align-items:center;
      flex-wrap:wrap;
    }
    .meta{font-size:12px; color:var(--sub); display:flex; gap:10px; flex-wrap:wrap}
    .tag{
      display:inline-flex; align-items:center; gap:6px;
      font-size:12px; padding:4px 10px; border-radius:999px;
      background: #fff; border:1px solid var(--line); color:var(--sub);
    }
    .badge{
      display:inline-flex; align-items:center; justify-content:center;
      width:30px; height:30px; border-radius:999px;
      background:rgba(255,255,255,.9); border:1px solid var(--line);
      font-size:18px;
    }
    .actions{display:flex; gap:8px; flex-shrink:0}
    .actions button{
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font-weight:800;
    }
    .actions button.del{border-color:#ffd6d6; color:var(--danger)}
    .summary{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    }
    .kpi{
      flex:1;
      min-width:160px;
      background:rgba(255,255,255,.86);
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
    }
    .kpi .label{font-size:12px; color:var(--sub)}
    .kpi .value{font-size:22px; font-weight:900; margin-top:2px}
    .small{font-size:12px;color:var(--sub)}
    .hr{height:1px;background:var(--line);margin:12px 0}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ğŸŸ¡ æ¥½ã—ã•å¡Šå›åãƒ¡ãƒ¢</h1>
        <div class="date" id="today"></div>
      </div>
      <div class="pill">ä¿å­˜ï¼šç«¯æœ«å†…ã ã‘ï¼ˆlocalStorageï¼‰</div>
    </header>

    <div class="grid">
      <!-- å…¥åŠ› -->
      <section class="card">
        <h2>â‘  ã„ã¾æ‹¾ã£ãŸğŸŸ¡ã‚’ãƒ¡ãƒ¢</h2>

        <div class="row">
          <input class="w-100" id="text" placeholder="ä¾‹ï¼šã‚«ãƒ•ã‚§ã®ç©ºæ°—ãŒè‰¯ã‹ã£ãŸ / é¢¨ãŒæ°—æŒã¡ã‚ˆã‹ã£ãŸ / çŒ«å‹•ç”»ã§ç¬‘ã£ãŸ" />
        </div>

        <div class="row" style="margin-top:10px">
          <select class="w-50" id="type">
            <option value="ğŸŸ¡ æ¥½ã—ã•">ğŸŸ¡ æ¥½ã—ã•</option>
            <option value="ğŸŸ¡ å°ã•ãªå›å¾©">ğŸŸ¡ å°ã•ãªå›å¾©</option>
            <option value="ğŸŸ¡ æ°—åˆ†ä¸ŠãŒã£ãŸ">ğŸŸ¡ æ°—åˆ†ä¸ŠãŒã£ãŸ</option>
            <option value="ğŸŸ¡ ã§ããŸ">ğŸŸ¡ ã§ããŸ</option>
            <option value="ğŸŸ¡ ã‚„ã•ã—ã•">ğŸŸ¡ ã‚„ã•ã—ã•</option>
          </select>

          <select class="w-50" id="place">
            <option value="å®¶">å®¶</option>
            <option value="å¤–">å¤–</option>
            <option value="ç§»å‹•">ç§»å‹•</option>
            <option value="æ–­é…’ä¼š">æ–­é…’ä¼š</option>
            <option value="é€šé™¢">é€šé™¢</option>
            <option value="ãã®ä»–">ãã®ä»–</option>
          </select>
        </div>

        <div class="row" style="margin-top:10px">
          <select class="w-33" id="mood">
            <option value="ğŸ™‚ ãµã¤ã†">ğŸ™‚ ãµã¤ã†</option>
            <option value="ğŸ˜Š ã„ã„">ğŸ˜Š ã„ã„</option>
            <option value="ğŸ˜Œ è½ã¡ç€ã">ğŸ˜Œ è½ã¡ç€ã</option>
            <option value="ğŸ˜®â€ğŸ’¨ ã—ã‚“ã©ã„">ğŸ˜®â€ğŸ’¨ ã—ã‚“ã©ã„</option>
            <option value="ğŸ˜µâ€ğŸ’« ãã¡ã‚ƒãã¡ã‚ƒ">ğŸ˜µâ€ğŸ’« ãã¡ã‚ƒãã¡ã‚ƒ</option>
          </select>

          <select class="w-33" id="hp">
            <option value="HP 5">HP 5ï¼ˆä½™è£•ï¼‰</option>
            <option value="HP 4">HP 4</option>
            <option value="HP 3" selected>HP 3ï¼ˆæ™®é€šï¼‰</option>
            <option value="HP 2">HP 2ï¼ˆçœã‚¨ãƒï¼‰</option>
            <option value="HP 1">HP 1ï¼ˆé™ç•Œï¼‰</option>
          </select>

          <select class="w-33" id="size">
            <option value="å°">å¡Šã‚µã‚¤ã‚ºï¼šå°</option>
            <option value="ä¸­" selected>å¡Šã‚µã‚¤ã‚ºï¼šä¸­</option>
            <option value="å¤§">å¡Šã‚µã‚¤ã‚ºï¼šå¤§</option>
          </select>
        </div>

        <div class="row" style="margin-top:10px">
          <textarea class="w-100" id="memo" placeholder="ã²ã¨ã“ã¨ï¼ˆä»»æ„ï¼‰ï¼šä½•ãŒè‰¯ã‹ã£ãŸï¼Ÿ ã©ã†åŠ©ã‹ã£ãŸï¼Ÿ ãªã©"></textarea>
        </div>

        <div class="row" style="margin-top:10px; align-items:center">
          <button class="btn w-50" id="add">è¿½åŠ </button>
          <button class="btn btn-sub w-50" id="addQuick">ğŸŸ¡ã ã‘è¿½åŠ ï¼ˆæœ€çŸ­ï¼‰</button>
        </div>

        <div class="note">
          ãƒ»ã€ŒğŸŸ¡ã ã‘è¿½åŠ ã€ã¯å†…å®¹ãŒç©ºã§ã‚‚ä¿å­˜ã™ã‚‹ï¼ˆã¨ã‚Šã‚ãˆãšæ‹¾ã†ç”¨ï¼‰ã€‚<br>
          ãƒ»ã“ã®ãƒ¡ãƒ¢ã®å‹ã¡æ¡ä»¶ï¼š<b>0å€‹ã®æ—¥ã‚‚OK</b>ã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚‹ã ã‘ã§å‰ã„ã€‚<br>
          ãƒ»æœ€é‡è¦ãƒ«ãƒ¼ãƒ«ï¼š<b>HPã‚’å‰Šã‚‹å›åã¯ã—ãªã„</b>ã€‚
        </div>

        <div class="hr"></div>

        <h2>â‘¡ ãƒ„ãƒ¼ãƒ«</h2>
        <div class="row">
          <button class="btn btn-sub w-50" id="export">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSONï¼‰</button>
          <button class="btn btn-sub w-50" id="importBtn">ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆJSONï¼‰</button>
          <input type="file" id="importFile" accept="application/json" style="display:none" />
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn btn-danger w-100" id="clearAll">å…¨å‰Šé™¤</button>
        </div>
        <div class="note small">
          â€»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç”¨ï¼ˆç«¯æœ«ç§»è¡Œã«ä¾¿åˆ©ï¼‰ã€‚<br>
          â€»ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ã€Œä¸Šæ›¸ãã€ã˜ã‚ƒãªãã€Œè¿½åŠ ã€ã€‚
        </div>
      </section>

      <!-- è¡¨ç¤º -->
      <section class="card">
        <h2>â‘¢ ä»Šæ—¥ã®å›åãƒ­ã‚°</h2>

        <div class="summary">
          <div class="kpi">
            <div class="label">ä»Šæ—¥ã®ğŸŸ¡æ•°</div>
            <div class="value" id="kpiCount">0</div>
            <div class="small" id="kpiNote">0å€‹ã§ã‚‚OK</div>
          </div>
          <div class="kpi">
            <div class="label">ã„ã¾ã®HPé¸æŠï¼ˆæœ€å¾Œã®è¨˜éŒ²ï¼‰</div>
            <div class="value" id="kpiHp">HP 3</div>
            <div class="small">HPã‚’å®ˆã£ãŸå›åã ã‘ğŸ›¡ï¸</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <select class="w-50" id="filterDay">
            <option value="today" selected>ä»Šæ—¥ã ã‘</option>
            <option value="all">å…¨éƒ¨</option>
          </select>
          <select class="w-50" id="filterType">
            <option value="all" selected>ç¨®é¡ï¼šå…¨éƒ¨</option>
            <option value="ğŸŸ¡ æ¥½ã—ã•">ğŸŸ¡ æ¥½ã—ã•</option>
            <option value="ğŸŸ¡ å°ã•ãªå›å¾©">ğŸŸ¡ å°ã•ãªå›å¾©</option>
            <option value="ğŸŸ¡ æ°—åˆ†ä¸ŠãŒã£ãŸ">ğŸŸ¡ æ°—åˆ†ä¸ŠãŒã£ãŸ</option>
            <option value="ğŸŸ¡ ã§ããŸ">ğŸŸ¡ ã§ããŸ</option>
            <option value="ğŸŸ¡ ã‚„ã•ã—ã•">ğŸŸ¡ ã‚„ã•ã—ã•</option>
          </select>
        </div>

        <div class="list" id="list"></div>

        <div class="note small">
          â€»ãƒ­ã‚°ã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã€‚åˆ¥ç«¯æœ«ã§ã¯åˆ¥ãƒ‡ãƒ¼ã‚¿ã€‚<br>
          â€»GitHub Pagesã®æ›´æ–°ã¯å°‘ã—å¾…ã¤ã¨åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚ã‚‹ã€‚
        </div>
      </section>
    </div>
  </div>

  <script>
    const KEY = "kiri_fun_orb_log_v1";

    const $ = (id)=>document.getElementById(id);

    const jpDate = (d)=>{
      const w = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][d.getDay()];
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const da = String(d.getDate()).padStart(2,"0");
      return `${y}/${m}/${da}(${w})`;
    };
    const hhmm = (d)=>{
      const h = String(d.getHours()).padStart(2,"0");
      const m = String(d.getMinutes()).padStart(2,"0");
      return `${h}:${m}`;
    };
    const todayKey = ()=>{
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const da = String(d.getDate()).padStart(2,"0");
      return `${y}-${m}-${da}`;
    };

    function load(){
      try{
        return JSON.parse(localStorage.getItem(KEY) || "[]");
      }catch(e){
        return [];
      }
    }
    function save(arr){
      localStorage.setItem(KEY, JSON.stringify(arr));
    }

    function addEntry({text, type, place, mood, hp, size, memo}){
      const now = new Date();
      const entry = {
        id: crypto?.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random().toString(16).slice(2),
        dateKey: todayKey(),
        dateLabel: jpDate(now),
        time: hhmm(now),
        text: text || "ğŸŸ¡",
        type, place, mood, hp, size,
        memo: memo || ""
      };
      const arr = load();
      arr.unshift(entry);
      save(arr);
      render();
    }

    function removeEntry(id){
      const arr = load().filter(x=>x.id!==id);
      save(arr);
      render();
    }

    function clearAll(){
      if(!confirm("å…¨éƒ¨æ¶ˆã™ï¼Ÿï¼ˆå–ã‚Šæ¶ˆã—ã§ããªã„ï¼‰")) return;
      localStorage.removeItem(KEY);
      render();
    }

    function getFiltered(){
      const arr = load();
      const dayMode = $("filterDay").value;
      const typeMode = $("filterType").value;
      const tk = todayKey();
      return arr.filter(x=>{
        const okDay = dayMode==="all" ? true : x.dateKey===tk;
        const okType = typeMode==="all" ? true : x.type===typeMode;
        return okDay && okType;
      });
    }

    function kpis(arr){
      const tk = todayKey();
      const todayArr = load().filter(x=>x.dateKey===tk);
      $("kpiCount").textContent = String(todayArr.length);
      $("kpiNote").textContent = todayArr.length===0 ? "0å€‹ã§ã‚‚OKï¼ˆãƒ­ã‚°ã‚¤ãƒ³å‹ã¡ï¼‰" : "æ‹¾ãˆã¦ã‚‹ğŸŸ¡";
      $("kpiHp").textContent = todayArr[0]?.hp || "HP 3";
    }

    function render(){
      const arr = getFiltered();
      kpis(arr);

      const list = $("list");
      list.innerHTML = "";

      if(arr.length===0){
        const empty = document.createElement("div");
        empty.className = "item";
        empty.innerHTML = `
          <div class="left">
            <div class="title"><span class="badge">ğŸŸ¡</span> ã¾ã ãƒ­ã‚°ãŒãªã„</div>
            <div class="meta">ã€Œ0å€‹ã§ã‚‚OKã€ãƒ«ãƒ¼ãƒ«ã§å‹ã¡ğŸ™‚</div>
          </div>
        `;
        list.appendChild(empty);
        return;
      }

      for(const x of arr){
        const el = document.createElement("div");
        el.className = "item";
        el.innerHTML = `
          <div class="left">
            <div class="title">
              <span class="badge">ğŸŸ¡</span>
              <span>${escapeHtml(x.text)}</span>
            </div>
            <div class="meta">
              <span>${x.type}</span>
              <span class="tag">${x.place}</span>
              <span class="tag">${x.mood}</span>
              <span class="tag">${x.hp}</span>
              <span class="tag">ã‚µã‚¤ã‚º:${x.size}</span>
              <span class="mono">${x.time}ãƒ»${x.dateLabel}</span>
            </div>
            ${x.memo ? `<div class="small" style="margin-top:6px;">${escapeHtml(x.memo)}</div>` : ""}
          </div>
          <div class="actions">
            <button class="del" data-del="${x.id}">å‰Šé™¤</button>
          </div>
        `;
        list.appendChild(el);
      }

      // bind delete
      list.querySelectorAll("button[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>removeEntry(btn.getAttribute("data-del")));
      });
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    // Export / Import
    function exportJSON(){
      const data = load();
      const blob = new Blob([JSON.stringify({version:1, exportedAt: new Date().toISOString(), data}, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "kiri_fun_orb_log_backup.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function importJSON(file){
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const obj = JSON.parse(reader.result);
          const incoming = Array.isArray(obj) ? obj : (obj.data || []);
          if(!Array.isArray(incoming)) throw new Error("invalid");
          const current = load();
          const ids = new Set(current.map(x=>x.id));
          const merged = [...incoming.filter(x=>x && x.id && !ids.has(x.id)), ...current];
          save(merged);
          alert(`ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼š${incoming.length}ä»¶ï¼ˆè¿½åŠ ã¯é‡è¤‡é™¤å¤–ï¼‰`);
          render();
        }catch(e){
          alert("èª­ã¿è¾¼ã¿å¤±æ•—ï¼šJSONå½¢å¼ãŒé•ã†ã‹ã‚‚");
        }
      };
      reader.readAsText(file);
    }

    // Init UI
    (function init(){
      const d = new Date();
      $("today").textContent = `æ—¥ä»˜ï¼š${jpDate(d)}`;

      $("add").addEventListener("click", ()=>{
        const text = $("text").value.trim();
        if(!text){
          alert("å†…å®¹ãŒç©ºã€‚ğŸŸ¡ã ã‘è¿½åŠ ãªã‚‰å³ã®ãƒœã‚¿ãƒ³ï¼");
          return;
        }
        addEntry({
          text,
          type: $("type").value,
          place: $("place").value,
          mood: $("mood").value,
          hp: $("hp").value,
          size: $("size").value,
          memo: $("memo").value.trim()
        });
        $("text").value = "";
        $("memo").value = "";
      });

      $("addQuick").addEventListener("click", ()=>{
        addEntry({
          text: $("text").value.trim() || "ğŸŸ¡",
          type: $("type").value,
          place: $("place").value,
          mood: $("mood").value,
          hp: $("hp").value,
          size: $("size").value,
          memo: $("memo").value.trim()
        });
        $("text").value = "";
        $("memo").value = "";
      });

      $("clearAll").addEventListener("click", clearAll);

      $("filterDay").addEventListener("change", render);
      $("filterType").addEventListener("change", render);

      $("export").addEventListener("click", exportJSON);

      $("importBtn").addEventListener("click", ()=> $("importFile").click());
      $("importFile").addEventListener("change", (e)=>{
        const file = e.target.files?.[0];
        if(file) importJSON(file);
        e.target.value = "";
      });

      render();
    })();
  </script>
</body>
</html>
